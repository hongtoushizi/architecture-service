## 任务调度

> 服务有两种类型，**Long Running**(应用)及**Batch**(任务)。**Docker Swarm**支持**Long Running**服务的运行，但不支持**Batch**服务的运行，所以我们需要一套任务调度的方案来解决这个问题。
>
> **Batch**服务同样基于Docker容器运行，遵循一个服务一个容器的原则，与**Long Running**服务隔离，并且每个**Batch**服务都会分配到一个独立的容器去运行，方便任务的隔离和管理。

## 简述

传统的任务调度服务，如crontab等，会有如下缺点:

- 任务分散，无法统一管理
- 单机部署，可用性差
- 无调度功能，机器之间的负载可能不均衡
- 交互性差，任务部署效率低
- 没有重试机制，任务可能运行失败
- 无法运行大规模分布式任务

而一个在运行在docker容器之上的**分布式任务调度服务**将提供以下功能:

- 统一的任务管理
  - 任务运行状态
  - 任务运行记录
  - 生命周期管理：任务的停止及回收
- 任务编排
  - 任务部署：支持一次性任务、定时任务、大规模分布式任务的运行
  - 资源限制：CPU、内存等资源限制
  - 任务依赖：多个任务之间可以有依赖关系，被依赖的任务会先执行
- 任务调度
  - 一致性：分布式调度策略保证任务的一致性，一次任务调度只会触发一次执行
  - 负载均衡：任务将优先调度到负载较低的机器上
  - 失败重试：任务失败后可被调度其他机器上重试，有最大重试次数
- 日志&监控
  - 任务日志收集到日志服务中
  - 任务容器的CPU、内存等数据收集到监控服务中

## 实例

#### [Job](https://github.com/ifintech/job)

一个简易方便的分布式任务调度方案，支持高可用及高扩展，支持docker任务(CLI模式调用)的调度与执行。项目提供一个简易的任务管理中心，并且可以与当前的日志服务及监控服务无缝结合。

但使用时需注意的是，其当前只支持一次性任务和定时任务的运行，不支持复杂的任务编排(大规模分布式任务、任务依赖)。并且任务的调度策略，只保证了任务执行的一致性，负载均衡及失败重试策略可以由**docker调度引擎**来支持。

总体来说，**Job**提供了一个简易的任务调度框架，支持简单轻量的任务调度。当系统里的任务规模不大，调度需求简单，可考虑用此套方案进行支撑。