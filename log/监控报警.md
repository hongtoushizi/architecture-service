# 监控报警

> 监控报警服务能让开发和运维同学实时了解线上的应用服务状况。并且能在出现故障时或在出现一定征兆时及时通知相关人员解决. 

## 监控

### 资源监控

> 对线上资源进行监控, 保证线上服务的可用性

- 系统监控
  - CPU 使用率
  - 内存使用率
  - 硬盘吞吐量
  - 硬盘读写次数
  - 网卡出入带宽
- 容器监控
  - CPU使用
  - 内存使用
  - 网卡出入带宽
- 网络监控
  - HTTP
  - Mysql
  - Redis

### [Beats](https://www.elastic.co/cn/products/beats)

beats是Elastic Stack下的一套开源数据采集工具。它能够收集系统负载、内存、硬盘以及每个进程的情况, 也可以嗅探网络流量, 支持HTTP, Thrift-RPC, Mysql, Redis等协议, 最后将数据送到Logstash或elasticsearch中, 方便后续的处理.

beats基于go语言实现, 支持扩展自定义的采集项.

### 应用监控

> 对应用日志进行监控, 保证业务持续稳定地运行.

每隔一定时间在`ElasticSearch`中按访问入口对日志数据进行聚合统计，从而获得需要的监控项数据。

`ElasticSearch`作为一个数据分析引擎, 它可以快速方便地对日志数据进行统计分析, 从而可以省去繁琐的数据聚合统计过程.  

**监控项**

- 异常监控
  - error级别日志数
  - warining级别日志数
- 平均访问时长
- 访问成功率

### Nginx监控

> 对Nginx日志进行监控, 保证线上通信稳定可靠

每隔一定时间在`ElasticSearch`中按请求的path对日志数据进行聚合统计, 从而获得需要的监控项数据。

**监控项**

- 状态码监控
  - 500以上状态数
  - 400以上状态数
- 平均请求时长
- 请求成功率

## 报警

> 监控指标在符合一定规则时, 则会触发报警, 按照报警级别选择相应的报警方式通知到相应的负责人处. 
>
> 对于所有的报警指标, 都会有默认报警规则对应, 无需开发人员进行配置. 同时也支持配置自定义的报警规则, 满足一些特殊需求.

### 报警级别

- **Notice** 该级别表示需要注意, 系统可能发生了问题, 需要人员进行关注
- **Warning** 该级别表示系统出现了一定错误, 但不影响主要业务的进行, 需要负责人查看具体情况并处理
- **Error** 该级别表示已经影响到了主要的业务流程, 需要人员立即介入处理

### 报警方式

- 邮件
- 短信
- 钉钉
- 微信

### 报警升级机制

当一条报警长时间未处理时, 其报警级别会提高, 保证线上所有的问题都能得到处理而不会遗漏

- 待支持

### 报警图表

> 提供一个简洁的报警图表, 帮助开发及运维同学了解线上的系统及应用的报警情况, 方便对线上服务和业务的运行状况做评估.

![WX20170708-153952@2x](https://ws4.sinaimg.cn/large/006tNc79ly1fhekxa2m87j31kw0z0n3y.jpg)

